#!/bin/sh
mkuuid () {
  od -x /dev/urandom | head -1 | awk '{
    OFS="-"; sub(/./,"4",$5); srand($6);
    sub(/./,substr("89ab",rand()*4,1),$6);
    print $2$3,$4,$5,$6,$7$8$9}'
}

if [ -f ./.bagtentrc ]; then
  . ./.bagtentrc
elif [ -f ../.bagtentrc ]; then
  . ../.bagtentrc
fi

name=$(${BAGTENT_NAMEGEN:=mkuuid})

if [ -z "${PWD%%*/content}" ]; then
  filepath="$name.md"
elif [ -d content ]; then
  filepath="content/$name.md"
else
  echo "content directory not found" >&2
  exit 1
fi

if [ "--open" = "$1" ]; then
  if [ -z "$EDITOR" ]; then
    EDITOR=nano
  fi
  $EDITOR "$filepath"
else
  touch "$filepath"
fi

echo "$name.md"
